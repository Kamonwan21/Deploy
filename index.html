<!DOCTYPE html>
<html>
<head>
  <base href="./">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="fluttertest">
  <link rel="apple-touch-icon" href="./icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png"/>
  <title>fluttertest</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- CSS Styles for Popup -->
  <style>
    .popup {
      display: none; /* Start with hidden */
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      width: 300px;
      border: 1px solid #333;
      background-color: #fff;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
    }
    .popup-content {
      padding: 20px;
      text-align: center;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <!-- Popup Element -->
  <div id="errorPopup" class="popup">
    <div class="popup-content">
      <span class="close-btn">&times;</span>
      <p id="errorMessage">This is an error message!</p>
    </div>
  </div>

  <!-- Flutter bootstrap script -->
  <script src="flutter_bootstrap.js" async></script>

  <!-- JavaScript for Error Handling -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const popup = document.getElementById('errorPopup');
      const closeBtn = document.querySelector('.close-btn');

      // ฟังก์ชันแสดงข้อผิดพลาด
      function showError(message) {
        const errorMessageElement = document.getElementById('errorMessage');
        errorMessageElement.textContent = message;
        popup.style.display = 'block';
      }

      // ฟังก์ชันปิด popup
      function closeError() {
        popup.style.display = 'none';
      }

      // Event Listener สำหรับปิด popup
      closeBtn.addEventListener('click', closeError);

      // ดักจับข้อผิดพลาดที่ไม่ได้จัดการ
      window.onerror = function(message, source, lineno, colno, error) {
        showError(`${message} at ${source}:${lineno}:${colno}`);
        return true; // ป้องกันไม่ให้ error แสดงใน console
      };

      // ดักจับข้อความ error ที่ใช้ console.error
      const originalConsoleError = console.error;
      console.error = function(...args) {
        showError(`Console Error: ${args.join(' ')}`);
        originalConsoleError.apply(console, args); // แสดงข้อความใน console ตามปกติ
      };

      // ฟังก์ชันทดสอบการทำงาน
      function triggerError() {
        console.error('This is a test error from console.error!');
        throw new Error('This is a test error from window.onerror!');
      }

      // ทริกเกอร์ข้อผิดพลาดเพื่อทดสอบ
      triggerError();
    });
  </script>
</body>
</html>
